<!DOCTYPE html>
<!-- saved from url=(0082)https://www.cryptologie.net/article/340/tls-pre-master-secrets-and-master-secrets/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>TLS, Pre-Master Secrets and Master Secrets</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Everything you want to know about TLS 1.2 is in RFC 5246. But as you may know, if you&#39;ve read RFCs before, it is not easy to parse (plus they have some sort of double spaces non-sense).
Before we can encrypt/MAC everything with keys to secure our connection, we need to go over a key exchange called the Handshake to safely agree on a set of keys for both parties to use. The handshake can currently  ...">
<meta name="author" content="david wong">


<script async="" src="./TLS, Pre-Master Secrets and Master Secrets_files/analytics.js.下载"></script><script src="./TLS, Pre-Master Secrets and Master Secrets_files/jquery-3.6.0.min.js.下载" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

<link rel="stylesheet" href="./TLS, Pre-Master Secrets and Master Secrets_files/bootstrap.min.css">
<script src="./TLS, Pre-Master Secrets and Master Secrets_files/collapse.js.下载"></script>

<link rel="stylesheet" href="./TLS, Pre-Master Secrets and Master Secrets_files/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

<script src="./TLS, Pre-Master Secrets and Master Secrets_files/webfontloader.js.下载"></script>
<script src="./TLS, Pre-Master Secrets and Master Secrets_files/snap.svg-min.js.下载"></script>
<script src="./TLS, Pre-Master Secrets and Master Secrets_files/underscore-umd-min.js.下载"></script>
<script src="./TLS, Pre-Master Secrets and Master Secrets_files/sequence-diagram-min.js.下载"></script>

<script src="./TLS, Pre-Master Secrets and Master Secrets_files/highlight.min.js.下载"></script>
<script src="./TLS, Pre-Master Secrets and Master Secrets_files/go.min.js.下载"></script>
<script>hljs.initHighlightingOnLoad();</script>
<link rel="stylesheet" href="./TLS, Pre-Master Secrets and Master Secrets_files/default.min.css">
<link rel="stylesheet" href="./TLS, Pre-Master Secrets and Master Secrets_files/monokai-sublime.min.css">


<link href="./TLS, Pre-Master Secrets and Master Secrets_files/css" rel="stylesheet" type="text/css">


<script type="text/x-mathjax-config;executed=true">
      MathJax.Hub.Config({
      jax: ["input/TeX","input/MathML","input/AsciiMath","output/CommonHTML"],
      extensions: ["tex2jax.js","mml2jax.js","asciimath2jax.js","MathMenu.js","MathZoom.js","AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
      extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },

      asciimath2jax: {
      ignoreClass: "comment"
      },
      tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      ignoreClass: "comment"
      }
      });
    </script>
<script data-cfasync="false" type="text/javascript" async="" src="./TLS, Pre-Master Secrets and Master Secrets_files/MathJax.js.下载">
    </script>

<link rel="alternate" type="application/rss+xml" title="RSS | David Wong | cryptologie.net" href="https://www.cryptologie.net/feed/index/html">

<link rel="stylesheet" type="text/css" href="./TLS, Pre-Master Secrets and Master Secrets_files/style.css">
<style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#mc_embed_signup input.mce_inline_error { border-color:#6B0505; } #mc_embed_signup div.mce_inline_error { margin: 0 0 1em 0; padding: 5px 10px; background-color:#6B0505; font-weight: bold; z-index: 1; color:#fff; }</style><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">.mjx-chtml {display: inline-block; line-height: 0; text-indent: 0; text-align: left; text-transform: none; font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; letter-spacing: normal; word-wrap: normal; word-spacing: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; margin: 0; padding: 1px 0}
.MJXc-display {display: block; text-align: center; margin: 1em 0; padding: 0}
.mjx-chtml[tabindex]:focus, body :focus .mjx-chtml[tabindex] {display: inline-table}
.mjx-full-width {text-align: center; display: table-cell!important; width: 10000em}
.mjx-math {display: inline-block; border-collapse: separate; border-spacing: 0}
.mjx-math * {display: inline-block; -webkit-box-sizing: content-box!important; -moz-box-sizing: content-box!important; box-sizing: content-box!important; text-align: left}
.mjx-numerator {display: block; text-align: center}
.mjx-denominator {display: block; text-align: center}
.MJXc-stacked {height: 0; position: relative}
.MJXc-stacked > * {position: absolute}
.MJXc-bevelled > * {display: inline-block}
.mjx-stack {display: inline-block}
.mjx-op {display: block}
.mjx-under {display: table-cell}
.mjx-over {display: block}
.mjx-over > * {padding-left: 0px!important; padding-right: 0px!important}
.mjx-under > * {padding-left: 0px!important; padding-right: 0px!important}
.mjx-stack > .mjx-sup {display: block}
.mjx-stack > .mjx-sub {display: block}
.mjx-prestack > .mjx-presup {display: block}
.mjx-prestack > .mjx-presub {display: block}
.mjx-delim-h > .mjx-char {display: inline-block}
.mjx-surd {vertical-align: top}
.mjx-mphantom * {visibility: hidden}
.mjx-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 2px 3px; font-style: normal; font-size: 90%}
.mjx-annotation-xml {line-height: normal}
.mjx-menclose > svg {fill: none; stroke: currentColor}
.mjx-mtr {display: table-row}
.mjx-mlabeledtr {display: table-row}
.mjx-mtd {display: table-cell; text-align: center}
.mjx-label {display: table-row}
.mjx-box {display: inline-block}
.mjx-block {display: block}
.mjx-span {display: inline}
.mjx-char {display: block; white-space: pre}
.mjx-itable {display: inline-table; width: auto}
.mjx-row {display: table-row}
.mjx-cell {display: table-cell}
.mjx-table {display: table; width: 100%}
.mjx-line {display: block; height: 0}
.mjx-strut {width: 0; padding-top: 1em}
.mjx-vsize {width: 0}
.MJXc-space1 {margin-left: .167em}
.MJXc-space2 {margin-left: .222em}
.MJXc-space3 {margin-left: .278em}
.mjx-chartest {display: block; visibility: hidden; position: absolute; top: 0; line-height: normal; font-size: 500%}
.mjx-chartest .mjx-char {display: inline}
.mjx-chartest .mjx-box {padding-top: 1000px}
.MJXc-processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MJXc-processed {display: none}
.mjx-test {display: block; font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow: hidden; height: 1px}
.mjx-ex-box-test {position: absolute; overflow: hidden; width: 1px; height: 60ex}
.mjx-line-box-test {display: table!important}
.mjx-line-box-test span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
#MathJax_CHTML_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.mjx-chtml .mjx-noError {line-height: 1.2; vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
.MJXc-TeX-unknown-R {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: normal; font-weight: normal}
.MJXc-TeX-unknown-I {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: italic; font-weight: normal}
.MJXc-TeX-unknown-B {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: normal; font-weight: bold}
.MJXc-TeX-unknown-BI {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: italic; font-weight: bold}
.MJXc-TeX-ams-R {font-family: MJXc-TeX-ams-R,MJXc-TeX-ams-Rw}
.MJXc-TeX-cal-B {font-family: MJXc-TeX-cal-B,MJXc-TeX-cal-Bx,MJXc-TeX-cal-Bw}
.MJXc-TeX-frak-R {font-family: MJXc-TeX-frak-R,MJXc-TeX-frak-Rw}
.MJXc-TeX-frak-B {font-family: MJXc-TeX-frak-B,MJXc-TeX-frak-Bx,MJXc-TeX-frak-Bw}
.MJXc-TeX-math-BI {font-family: MJXc-TeX-math-BI,MJXc-TeX-math-BIx,MJXc-TeX-math-BIw}
.MJXc-TeX-sans-R {font-family: MJXc-TeX-sans-R,MJXc-TeX-sans-Rw}
.MJXc-TeX-sans-B {font-family: MJXc-TeX-sans-B,MJXc-TeX-sans-Bx,MJXc-TeX-sans-Bw}
.MJXc-TeX-sans-I {font-family: MJXc-TeX-sans-I,MJXc-TeX-sans-Ix,MJXc-TeX-sans-Iw}
.MJXc-TeX-script-R {font-family: MJXc-TeX-script-R,MJXc-TeX-script-Rw}
.MJXc-TeX-type-R {font-family: MJXc-TeX-type-R,MJXc-TeX-type-Rw}
.MJXc-TeX-cal-R {font-family: MJXc-TeX-cal-R,MJXc-TeX-cal-Rw}
.MJXc-TeX-main-B {font-family: MJXc-TeX-main-B,MJXc-TeX-main-Bx,MJXc-TeX-main-Bw}
.MJXc-TeX-main-I {font-family: MJXc-TeX-main-I,MJXc-TeX-main-Ix,MJXc-TeX-main-Iw}
.MJXc-TeX-main-R {font-family: MJXc-TeX-main-R,MJXc-TeX-main-Rw}
.MJXc-TeX-math-I {font-family: MJXc-TeX-math-I,MJXc-TeX-math-Ix,MJXc-TeX-math-Iw}
.MJXc-TeX-size1-R {font-family: MJXc-TeX-size1-R,MJXc-TeX-size1-Rw}
.MJXc-TeX-size2-R {font-family: MJXc-TeX-size2-R,MJXc-TeX-size2-Rw}
.MJXc-TeX-size3-R {font-family: MJXc-TeX-size3-R,MJXc-TeX-size3-Rw}
.MJXc-TeX-size4-R {font-family: MJXc-TeX-size4-R,MJXc-TeX-size4-Rw}
.MJXc-TeX-vec-R {font-family: MJXc-TeX-vec-R,MJXc-TeX-vec-Rw}
.MJXc-TeX-vec-B {font-family: MJXc-TeX-vec-B,MJXc-TeX-vec-Bx,MJXc-TeX-vec-Bw}
@font-face {font-family: MJXc-TeX-ams-R; src: local('MathJax_AMS'), local('MathJax_AMS-Regular')}
@font-face {font-family: MJXc-TeX-ams-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_AMS-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_AMS-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-cal-B; src: local('MathJax_Caligraphic Bold'), local('MathJax_Caligraphic-Bold')}
@font-face {font-family: MJXc-TeX-cal-Bx; src: local('MathJax_Caligraphic'); font-weight: bold}
@font-face {font-family: MJXc-TeX-cal-Bw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Caligraphic-Bold.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Bold.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-frak-R; src: local('MathJax_Fraktur'), local('MathJax_Fraktur-Regular')}
@font-face {font-family: MJXc-TeX-frak-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Fraktur-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Fraktur-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Fraktur-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-frak-B; src: local('MathJax_Fraktur Bold'), local('MathJax_Fraktur-Bold')}
@font-face {font-family: MJXc-TeX-frak-Bx; src: local('MathJax_Fraktur'); font-weight: bold}
@font-face {font-family: MJXc-TeX-frak-Bw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Fraktur-Bold.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Fraktur-Bold.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Fraktur-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-math-BI; src: local('MathJax_Math BoldItalic'), local('MathJax_Math-BoldItalic')}
@font-face {font-family: MJXc-TeX-math-BIx; src: local('MathJax_Math'); font-weight: bold; font-style: italic}
@font-face {font-family: MJXc-TeX-math-BIw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Math-BoldItalic.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Math-BoldItalic.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Math-BoldItalic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-R; src: local('MathJax_SansSerif'), local('MathJax_SansSerif-Regular')}
@font-face {font-family: MJXc-TeX-sans-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-B; src: local('MathJax_SansSerif Bold'), local('MathJax_SansSerif-Bold')}
@font-face {font-family: MJXc-TeX-sans-Bx; src: local('MathJax_SansSerif'); font-weight: bold}
@font-face {font-family: MJXc-TeX-sans-Bw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Bold.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Bold.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-I; src: local('MathJax_SansSerif Italic'), local('MathJax_SansSerif-Italic')}
@font-face {font-family: MJXc-TeX-sans-Ix; src: local('MathJax_SansSerif'); font-style: italic}
@font-face {font-family: MJXc-TeX-sans-Iw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Italic.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Italic.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-script-R; src: local('MathJax_Script'), local('MathJax_Script-Regular')}
@font-face {font-family: MJXc-TeX-script-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Script-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Script-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Script-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-type-R; src: local('MathJax_Typewriter'), local('MathJax_Typewriter-Regular')}
@font-face {font-family: MJXc-TeX-type-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Typewriter-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Typewriter-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Typewriter-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-cal-R; src: local('MathJax_Caligraphic'), local('MathJax_Caligraphic-Regular')}
@font-face {font-family: MJXc-TeX-cal-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Caligraphic-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-B; src: local('MathJax_Main Bold'), local('MathJax_Main-Bold')}
@font-face {font-family: MJXc-TeX-main-Bx; src: local('MathJax_Main'); font-weight: bold}
@font-face {font-family: MJXc-TeX-main-Bw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Main-Bold.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-I; src: local('MathJax_Main Italic'), local('MathJax_Main-Italic')}
@font-face {font-family: MJXc-TeX-main-Ix; src: local('MathJax_Main'); font-style: italic}
@font-face {font-family: MJXc-TeX-main-Iw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Main-Italic.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-R; src: local('MathJax_Main'), local('MathJax_Main-Regular')}
@font-face {font-family: MJXc-TeX-main-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Main-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-math-I; src: local('MathJax_Math Italic'), local('MathJax_Math-Italic')}
@font-face {font-family: MJXc-TeX-math-Ix; src: local('MathJax_Math'); font-style: italic}
@font-face {font-family: MJXc-TeX-math-Iw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Math-Italic.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size1-R; src: local('MathJax_Size1'), local('MathJax_Size1-Regular')}
@font-face {font-family: MJXc-TeX-size1-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Size1-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size2-R; src: local('MathJax_Size2'), local('MathJax_Size2-Regular')}
@font-face {font-family: MJXc-TeX-size2-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Size2-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size3-R; src: local('MathJax_Size3'), local('MathJax_Size3-Regular')}
@font-face {font-family: MJXc-TeX-size3-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Size3-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size4-R; src: local('MathJax_Size4'), local('MathJax_Size4-Regular')}
@font-face {font-family: MJXc-TeX-size4-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Size4-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-vec-R; src: local('MathJax_Vector'), local('MathJax_Vector-Regular')}
@font-face {font-family: MJXc-TeX-vec-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Vector-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Vector-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Vector-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-vec-B; src: local('MathJax_Vector Bold'), local('MathJax_Vector-Bold')}
@font-face {font-family: MJXc-TeX-vec-Bx; src: local('MathJax_Vector'); font-weight: bold}
@font-face {font-family: MJXc-TeX-vec-Bw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/eot/MathJax_Vector-Bold.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/woff/MathJax_Vector-Bold.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/fonts/HTML-CSS/TeX/otf/MathJax_Vector-Bold.otf') format('opentype')}
</style></head>
<body style="zoom: 1;"><div id="MathJax_Message" style="display: none;"></div>
<header>
<div class="flexflex">
<img src="./TLS, Pre-Master Secrets and Master Secrets_files/me.png" alt="david wong" class="img-circle">
<p><i class="fa fa-comment"></i> Hey! I'm <strong>David</strong>, the author of the <a href="https://www.manning.com/books/real-world-cryptography?a_aid=Realworldcrypto&amp;a_bid=ad500e09">Real-World Cryptography book</a>. I'm a crypto engineer at <a href="http://o1labs.org/">O(1) Labs</a> on the <a href="https://minaprotocol.com/">Mina cryptocurrency</a>, previously I was the security lead for <a href="https://www.diem.com/">Diem</a> (formerly Libra) at <a href="https://facebook.com/" target="_blank">Novi (Facebook)</a>, and a security consultant for the Cryptography Services of <a href="https://www.nccgroup.com/">NCC Group</a>. This is my blog about <strong>cryptography</strong> and <strong>security</strong> and other related topics that I find interesting.</p>
</div>
</header>
<nav class="navbar navbar-default" role="navigation">
<div class="container">

<div class="navbar-header">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
</div>

<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
<ul class="nav navbar-nav">
<li class="active"><a href="https://www.cryptologie.net/">Blog</a></li>
<li><a href="https://www.cryptologie.net/links">Links</a></li>
<li><a href="https://www.youtube.com/playlist?list=PLBJMt6zV1c7FN3IjBDr9lydgqGzh_SqHV" target="_blank">Videos</a></li>
<li><a href="https://www.cryptologie.net/graphics">Graphics</a></li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li><a href="https://twitter.com/cryptodavidw" target="_blank"><i class="fab fa-twitter"></i></a></li>
<li><a href="https://github.com/mimoo" target="_blank"><i class="fab fa-github"></i></a></li>
<li><a href="https://www.cryptologie.net/contact/"><i class="fas fa-envelope"></i></a></li>
</ul>
</div>
</div>
</nav>
<div class="container">
<div class="grid">
<main>
<article class="mathjax">
<h1>TLS, Pre-Master Secrets and Master Secrets <small class="date" title="2016-03-07 20:53:21"><i class="far fa-clock"></i> posted March 2016</small></h1>
<p>Everything you want to know about <em>TLS 1.2</em> is in <a href="https://tools.ietf.org/html/rfc5246#section-8.1.2">RFC 5246</a>. But as you may know, if you've read RFCs before, it is not easy to parse (plus they have some sort of double spaces non-sense).</p>
<p>Before we can encrypt/MAC everything with keys to secure our connection, we need to go over a key exchange called the <em>Handshake</em> to safely agree on a set of keys for both parties to use. The handshake can currently use 5 different algorithms to do the key exchange: RSA, Diffie-Hellman, Elliptic Curve Diffie-Hellman and the ephemeral versions of the last two algorithms.</p>
<p>This blogpost is about what happens between this key exchange and the encryption/authentication of data.</p>
<h2>The Pre-Master Secret</h2>
<p>The pre-master key is the value you directly obtain from the key exchange (e.g. <span class="MathJax_Preview" style="display: none;"></span><span id="MathJax-Element-1-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mspace width=&quot;0.444em&quot; /&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mspace width=&quot;0.333em&quot; /&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 121%; position: relative;"><span id="MJXc-Node-1" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-2" class="mjx-mrow"><span id="MJXc-Node-3" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.003em;"><span id="MJXc-Node-4" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.467em; padding-right: 0.003em;">g</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0.076em; padding-right: 0.071em;"><span id="MJXc-Node-5" class="mjx-texatom" style=""><span id="MJXc-Node-6" class="mjx-mrow"><span id="MJXc-Node-7" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">a</span></span><span id="MJXc-Node-8" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.313em;">b</span></span></span></span></span></span><span id="MJXc-Node-9" class="mjx-TeXmathchoice"><span id="MJXc-Node-10" class="mjx-mspace" style="width: 0.444em; height: 0px;"></span></span><span id="MJXc-Node-11" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.467em; padding-bottom: 0.571em;">(</span></span><span id="MJXc-Node-12" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.416em; padding-bottom: 0.364em;">mod</span></span><span id="MJXc-Node-13" class="mjx-mspace" style="width: 0.333em; height: 0px;"></span><span id="MJXc-Node-14" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.467em;">p</span></span><span id="MJXc-Node-15" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.467em; padding-bottom: 0.571em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>g</mi><mrow class="MJX-TeXAtom-ORD"><mi>a</mi><mi>b</mi></mrow></msup><mspace width="0.444em"></mspace><mo stretchy="false">(</mo><mi>mod</mi><mspace width="0.333em"></mspace><mi>p</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-1">g^{ab} \pmod{p}</script> if using Diffie-Hellman). Its length varies depending on the algorithm and the parameters used during the key exchange. To make things simpler, we would want a fixed-length value to derive the keys for any cipher suite we would want to use. This is the reason behind a <em>pre</em> master secret. The fixed-length value we'll call <em>master secret</em>. <a href="https://tools.ietf.org/html/rfc5246#section-8.1">Here</a> the RFC tells us how to compute it from the pre-master secret after having removed the leading zeros bytes.</p>
<pre><code class="hljs nginx"><span class="hljs-attribute">master_secret</span> = PRF(pre_master_secret, <span class="hljs-string">"master secret"</span>,
                    ClientHello.random + ServerHello.random)
                    [<span class="hljs-number">0</span>..<span class="hljs-number">47</span>];</code></pre>
<p>The two random values <code>ClientHello.random</code> and <code>ServerHello.random</code>, sometimes called "nonces", are randomly generated and sent during the ClientHello of each parties. This is to bound the soon-to-be master key to this session. <code>PRF</code> stands for <em>Pseudo-random function</em>, basically some concrete construction that emulates a random oracle: given an input will produce an output computationally indistinguishable from a truly random sequence. But let's move on, and we will see later what exactly is that PRF.</p>
<h2>The Master Secret</h2>
<p>A master secret is always 48 bytes. So now that we have a fixed length value, we can derive 4 keys from it:</p>
<ul>
<li>client_write_MAC_key</li>
<li>server_write_MAC_key</li>
<li>client_write_key</li>
<li>server_write_key</li>
</ul>
<p>As you can probably guess, <em>MAC keys</em> are for the authentication and integrity with whatever MAC algorithm you chose in the cipher suite, <em>write keys</em> are for the symmetric encryption.</p>
<p>Interestingly, two keys are generated for every purpose: one key per side. This is mostly by respect of good practices. Always segregate the use of your keys.</p>
<p>The symmetric ciphers chosen in the handshake will dictate how long these keys we generate need to be. Note that <em>AEAD ciphers</em> that combine both authentication and encryption will not need MAC keys but will need two other keys instead: client_write_IV and server_write_IV. This is because their MAC keys are directly derived from the encryption keys.</p>
<p>The same PRF we used on the pre-master key will be used on the master-key over and over until enough bytes have been created for the keys. From <a href="https://tools.ietf.org/html/rfc5246#section-6.3">the section 6.3 of the RFC</a>:</p>
<pre><code class="hljs nginx"><span class="hljs-attribute">key_block</span> = PRF(SecurityParameters.master_secret,
                <span class="hljs-string">"key expansion"</span>,
                SecurityParameters.server_random +
                SecurityParameters.client_random);</code></pre>
<p>The <code>key_block</code> value is then cut into enough keys.</p>
<p>That's it! Here's a recap:</p>
<p>Diffie-Hellman -&gt; pre-master key -&gt; 48bytes master key -&gt; 4 variable-length keys.</p>
<h2>The PRF</h2>
<p>OK. Now that we got a nice global view of the process, let's dig deeper. The PRF used in TLS 1.2 <a href="https://tools.ietf.org/html/rfc5246#section-5">is discussed here</a>. It is quite different from the PRF used in TLS 1.1, <a href="https://tools.ietf.org/html/rfc4346#section-5">see here</a>. </p>
<p>Remember, for example how it was used to transform the pre-master key into a master key:</p>
<pre><code class="hljs nginx"><span class="hljs-attribute">master_secret</span> = PRF(pre_master_secret, <span class="hljs-string">"master secret"</span>,
                    ClientHello.random + ServerHello.random)
                    [<span class="hljs-number">0</span>..<span class="hljs-number">47</span>];</code></pre>
<p>This is how the PRF function is used:</p>
<pre><code class="hljs bash">PRF(secret, label, seed) = P_&lt;<span class="hljs-built_in">hash</span>&gt;(secret, label + seed)</code></pre>
<p>If you want to follow along with code, here's the <a href="https://golang.org/src/crypto/tls/prf.go#L145">relevant golang code</a></p>
<pre><code class="hljs">P_hash(secret, seed) = HMAC_hash(secret, A(1) + seed) +
                       HMAC_hash(secret, A(2) + seed) +
                       HMAC_hash(secret, A(3) + seed) + ...</code></pre>
<p>where <code>+</code> indicates concatenation, A() is defined as:</p>
<pre><code class="hljs cs">A(<span class="hljs-number">0</span>) = <span class="hljs-function">seed
<span class="hljs-title">A</span>(<span class="hljs-params">i</span>) </span>= HMAC_hash(secret, A(i<span class="hljs-number">-1</span>))</code></pre>
<p>This was a copy/paste from the RFC. To make it clearer: We use the <code>label</code> string ("master secret" in our example) concatenated with the two peers' random values as a <code>seed</code>.</p>
<p>We then MAC the seed with our pre-master secret as the key. We use the first output. Iterating the MAC gives us the subsequent values that we can append to our output. </p>
<p><span class="MathJax_Preview" style="display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-2-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;H&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;H&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 121%; text-align: center; position: relative;"><span id="MJXc-Node-16" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-17" class="mjx-mrow"><span id="MJXc-Node-18" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-19" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">u</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-20" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.364em;">0</span></span></span></span><span id="MJXc-Node-21" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.106em; padding-bottom: 0.313em;">=</span></span><span id="MJXc-Node-22" class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.313em;">l</span></span><span id="MJXc-Node-23" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">a</span></span><span id="MJXc-Node-24" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.313em;">b</span></span><span id="MJXc-Node-25" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">e</span></span><span id="MJXc-Node-26" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.313em;">l</span></span><span id="MJXc-Node-27" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.313em; padding-bottom: 0.416em;">+</span></span><span id="MJXc-Node-28" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">s</span></span><span id="MJXc-Node-29" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">e</span></span><span id="MJXc-Node-30" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">r</span></span><span id="MJXc-Node-31" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">v</span></span><span id="MJXc-Node-32" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">e</span></span><span id="MJXc-Node-33" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">r</span></span><span id="MJXc-Node-34" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.261em; padding-right: 0.057em;">H</span></span><span id="MJXc-Node-35" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">e</span></span><span id="MJXc-Node-36" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.313em;">l</span></span><span id="MJXc-Node-37" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.313em;">l</span></span><span id="MJXc-Node-38" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">o</span></span><span id="MJXc-Node-39" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.152em; padding-bottom: 0.364em;">.</span></span><span id="MJXc-Node-40" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">r</span></span><span id="MJXc-Node-41" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">a</span></span><span id="MJXc-Node-42" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">n</span></span><span id="MJXc-Node-43" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.313em; padding-right: 0.003em;">d</span></span><span id="MJXc-Node-44" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">o</span></span><span id="MJXc-Node-45" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">m</span></span><span id="MJXc-Node-46" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.313em; padding-bottom: 0.416em;">+</span></span><span id="MJXc-Node-47" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">c</span></span><span id="MJXc-Node-48" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.313em;">l</span></span><span id="MJXc-Node-49" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.416em; padding-bottom: 0.313em;">i</span></span><span id="MJXc-Node-50" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">e</span></span><span id="MJXc-Node-51" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">n</span></span><span id="MJXc-Node-52" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.416em; padding-bottom: 0.313em;">t</span></span><span id="MJXc-Node-53" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.261em; padding-right: 0.057em;">H</span></span><span id="MJXc-Node-54" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">e</span></span><span id="MJXc-Node-55" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.313em;">l</span></span><span id="MJXc-Node-56" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.313em;">l</span></span><span id="MJXc-Node-57" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">o</span></span><span id="MJXc-Node-58" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.152em; padding-bottom: 0.364em;">.</span></span><span id="MJXc-Node-59" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">r</span></span><span id="MJXc-Node-60" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">a</span></span><span id="MJXc-Node-61" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">n</span></span><span id="MJXc-Node-62" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.313em; padding-right: 0.003em;">d</span></span><span id="MJXc-Node-63" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">o</span></span><span id="MJXc-Node-64" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">m</span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>u</mi><mn>0</mn></msub><mo>=</mo><mi>l</mi><mi>a</mi><mi>b</mi><mi>e</mi><mi>l</mi><mo>+</mo><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>H</mi><mi>e</mi><mi>l</mi><mi>l</mi><mi>o</mi><mo>.</mo><mi>r</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>o</mi><mi>m</mi><mo>+</mo><mi>c</mi><mi>l</mi><mi>i</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>H</mi><mi>e</mi><mi>l</mi><mi>l</mi><mi>o</mi><mo>.</mo><mi>r</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>o</mi><mi>m</mi></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-2"> u_0 = label + serverHello.random + clientHello.random </script></p>
<p><span class="MathJax_Preview" style="display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-3-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;H&lt;/mi&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 121%; text-align: center; position: relative;"><span id="MJXc-Node-65" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-66" class="mjx-mrow"><span id="MJXc-Node-67" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-68" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">u</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-69" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.416em; padding-bottom: 0.313em;">i</span></span></span></span><span id="MJXc-Node-70" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.106em; padding-bottom: 0.313em;">=</span></span><span id="MJXc-Node-71" class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.261em; padding-right: 0.057em;">H</span></span><span id="MJXc-Node-72" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.261em; padding-right: 0.081em;">M</span></span><span id="MJXc-Node-73" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.519em; padding-bottom: 0.261em;">A</span></span><span id="MJXc-Node-74" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.467em; padding-bottom: 0.313em; padding-right: 0.045em;">C</span></span><span id="MJXc-Node-75" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.467em; padding-bottom: 0.571em;">(</span></span><span id="MJXc-Node-76" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">s</span></span><span id="MJXc-Node-77" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">e</span></span><span id="MJXc-Node-78" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">c</span></span><span id="MJXc-Node-79" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">r</span></span><span id="MJXc-Node-80" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">e</span></span><span id="MJXc-Node-81" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.416em; padding-bottom: 0.313em;">t</span></span><span id="MJXc-Node-82" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.152em; padding-bottom: 0.519em;">,</span></span><span id="MJXc-Node-83" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-84" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">u</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-85" class="mjx-texatom" style=""><span id="MJXc-Node-86" class="mjx-mrow"><span id="MJXc-Node-87" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.416em; padding-bottom: 0.313em;">i</span></span><span id="MJXc-Node-88" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.313em; padding-bottom: 0.416em;">−</span></span><span id="MJXc-Node-89" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.364em;">1</span></span></span></span></span></span><span id="MJXc-Node-90" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.467em; padding-bottom: 0.571em;">)</span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>u</mi><mi>i</mi></msub><mo>=</mo><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi><mo stretchy="false">(</mo><mi>s</mi><mi>e</mi><mi>c</mi><mi>r</mi><mi>e</mi><mi>t</mi><mo>,</mo><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-3"> u_i = HMAC(secret, u_{i-1}) </script></p>
<p><span class="MathJax_Preview" style="display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-4-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;&amp;#x22EF;&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 121%; text-align: center; position: relative;"><span id="MJXc-Node-91" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-92" class="mjx-mrow"><span id="MJXc-Node-93" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">o</span></span><span id="MJXc-Node-94" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">u</span></span><span id="MJXc-Node-95" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.416em; padding-bottom: 0.313em;">t</span></span><span id="MJXc-Node-96" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.467em;">p</span></span><span id="MJXc-Node-97" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">u</span></span><span id="MJXc-Node-98" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.416em; padding-bottom: 0.313em;">t</span></span><span id="MJXc-Node-99" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.106em; padding-bottom: 0.313em;">=</span></span><span id="MJXc-Node-100" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-101" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">u</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-102" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.364em;">1</span></span></span></span><span id="MJXc-Node-103" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.152em; padding-bottom: 0.519em;">,</span></span><span id="MJXc-Node-104" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-105" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.209em; padding-bottom: 0.313em;">u</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-106" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.364em; padding-bottom: 0.364em;">2</span></span></span></span><span id="MJXc-Node-107" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.152em; padding-bottom: 0.519em;">,</span></span><span id="MJXc-Node-108" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.003em; padding-bottom: 0.313em;">⋯</span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>o</mi><mi>u</mi><mi>t</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo>=</mo><msub><mi>u</mi><mn>1</mn></msub><mo>,</mo><msub><mi>u</mi><mn>2</mn></msub><mo>,</mo><mo>⋯</mo></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-4"> output = u_1 , u_2 , \cdots </script>
This goes on and on until the output is long enough to cover the 48 bytes of the master key (or the 4 keys if we're applying to PRF on the master key).</p>
<p>If P_256 is being used, then SHA-256 is being used. This means the output of HMAC will be 256 bits (32 bytes). To get the 48 bytes of the master key, two iterations are enough, and the remaining bytes can be discarded.</p>
</article>
<div class="end_post">Well done! You've reached the end of my post. Now you can <a href="https://www.cryptologie.net/article/340/tls-pre-master-secrets-and-master-secrets/">leave a comment</a> or read something else.</div>
<div id="links" style="display:grid; grid-template-columns: 1fr 1fr; font-size:13px;grid-column-gap: 20px;">
<div class="popular">
<p>Here are some random <strong>popular</strong> articles:</p>
<ul class="fa-ul">
<li>- <a href="https://www.cryptologie.net/article/400/maybe-you-shouldnt-skip-sha-3/">Maybe you shouldn't skip SHA-3</a></li>
<li>- <a href="https://www.cryptologie.net/article/472/what-is-the-bls-signature-scheme/">What is the BLS signature scheme?</a></li>
<li>- <a href="https://www.cryptologie.net/article/193/schnorrs-signature-and-non-interactive-protocols/">Schnorr's Signature and non-interactive Protocols</a></li>
<li>- <a href="https://www.cryptologie.net/article/413/beast-an-explanation-of-the-cbc-attack-on-tls/">BEAST: An Explanation of the CBC Attack on TLS </a></li>
<li>- <a href="https://www.cryptologie.net/article/372/key-compromise-impersonation-attacks-kci/">Key Compromise Impersonation attacks (KCI)</a></li>
<li>- <a href="https://www.cryptologie.net/article/449/problems-that-udp-and-only-udp-has/">Problems that UDP and only UDP has</a></li>
<li>- <a href="https://www.cryptologie.net/article/471/database-encryption/">Database Encryption</a></li>
</ul>
</div>
<div class="links2">
<p>Here are some random <strong>recent</strong> articles:</p>
<ul class="fa-ul">
<li>- <a href="https://www.cryptologie.net/article/549/how-to-write-a-tic-tac-toe-zkapp/">How to write a tic-tac-toe zkapp</a></li>
<li>- <a href="https://www.cryptologie.net/article/526/maller-optimization-to-reduce-proof-size/">Maller optimization to reduce proof size</a></li>
<li>- <a href="https://www.cryptologie.net/article/552/contributing-to-open-source-while-learning-rust-and-zero-knowledge-proofs/">Contributing to open source while learning Rust and zero-knowledge proofs</a></li>
<li>- <a href="https://www.cryptologie.net/article/557/linearization-in-plonk-and-kimchi-why/">Linearization in Plonk and Kimchi. Why?</a></li>
<li>- <a href="https://www.cryptologie.net/article/528/what-is-an-inner-product-argument-part-1/">What is an inner product argument? Part 1</a></li>
<li>- <a href="https://www.cryptologie.net/article/547/the-cairo-snark-cpu-architecture-in-one-example/">The Cairo SNARK CPU architecture in one example</a></li>
<li>- <a href="https://www.cryptologie.net/article/556/kimchi-at-zk-summit-7/">Kimchi at ZK Summit 7</a></li>
</ul>
</div>
</div>
<div id="comments">
<h2>Comments</h2>
<div class="comment">
<h4>
<a href="https://www.cryptologie.net/article/340/tls-pre-master-secrets-and-master-secrets/No" rel="nofollow" target="_blank">Ahsan</a>
</h4>
<p>Very useful information i have so many question about PRF and master secret key but this post cover the all of my question. Thanks for this useful info can you explain client finished message and how to verify client finished message.<br>
I am using TLS 1.2 and my cipher is ECDHE_RSA_WITH_AES_128_SHA256.</p>
</div>
<div class="comment">
<h4>
david
</h4>
<p>the client finished message should be a normal TLS handshake message, except that the payload is encrypted this time and the thing should contain a MAC of the previous transcript from the client point of view.</p>
</div>
<div class="comment">
<h4>
Ahsan
</h4>
<p>Sorry i am using DTLS 1.2 instead TLS 1.2. Kindly explain the structure of finished message, like how many bytes for "nonce", how many bytes are encrypted data and how many bytes for authentication tag.</p>
</div>
<div class="comment">
<h4>
david
</h4>
<p>Ahsan: DTLS is a bit different from TLS. Not sure how it works exactly. Let me take a look. In the mean time you can also take a look there: https://tools.ietf.org/html/rfc6347#section-4.2</p>
</div>
<div class="comment">
<h4>
david
</h4>
<p>Ahsan I replied in a different blog post, check: http://cryptologie.net/article/353/dtls-and-finished-messages/</p>
</div>
<div class="comment">
<h4>
Boris
</h4>
<p>Thank you for very interesting article! Could you give code prf function on C++?</p>
</div>
<div class="comment">
<h4>
David
</h4>
<p>I have better, the source code in Go :)<br>
<br>
https://github.com/golang/go/blob/master/src/crypto/tls/prf.go<br>
<br>
and the tests:<br>
<br>
https://github.com/golang/go/blob/master/src/crypto/tls/prf_test.go</p>
</div>
<div class="comment">
<h4>
Mike
</h4>
<p>Small quibble: around where you say "The pre-master key is the value you directly obtain from the key exchange" - shouldn't the b be an exponent?</p>
</div>
<div class="comment">
<h4>
david
</h4>
<p>yes Mike! Thanks for pointing that out :) </p>
</div>
<div class="comment">
<h4>
Mike
</h4>
<p>Excellent work, btw! Thanks for sharing!</p>
</div>
<div class="comment">
<h4>
Darshan K.
</h4>
<p>Quite a stupid query here.<br>
If an attacker gets PRN during the ClientHello, wouldn't he be able to generate the PMS and Master-secret? If not, what protect this? I am sure I am missing a bit here. </p>
</div>
<div class="comment">
<h4>
david
</h4>
<p>PRN?</p>
</div>
<div class="comment">
<h4>
david
</h4>
<p>if you mean the random numbers in the clientHello and serverHello. These are not enough to generate the PMS. You also need a key, which is the shared secret computed out of the key exchange.</p>
</div>
<div class="comment">
<h4>
<a href="https://mysslonline.com/" rel="nofollow" target="_blank">Raj</a>
</h4>
<p>Very nicely written. I would like to share it with my co-workers to improve their knowledge</p>
</div>
<div class="comment">
<h4>
tsusanka
</h4>
<p>Still useful, thank you!</p>
</div>
<div class="comment">
<h4>
Christian
</h4>
<p>Thank you very much for your well written article. It really helped me to find a problem im my own TLS implementation.</p>
</div>
<div class="comment">
<h4>
<a href="https://www.cryptologie.net/article/340/tls-pre-master-secrets-and-master-secrets/no" rel="nofollow" target="_blank">Samsuddin Sikder</a>
</h4>
<p>hi<br>
you have provided go programming source code, do you have any link where i can see source code on C program.<br>
<br>
sadiksikder@gmail.com</p>
</div>
<div class="comment">
<h4>
darkangel
</h4>
<p>thanks for the infos, i have C# code for the prf(), if any one need it, just copy and paste, but not sure if it works or not, since i am having trouble decrypting the finish handshake message, but i think it should meet tls 1.0 requirement.<br>
<br>
public static byte[] PRF(byte[] secret, byte[] label, byte[] seed, int outputLength)<br>
{<br>
List&lt;byte&gt; s1 = new List&lt;byte&gt;();<br>
List&lt;byte&gt; s2 = new List&lt;byte&gt;();<br>
<br>
int size = (int)Math.Ceiling((double)secret.Length / 2);<br>
<br>
s1.AddRange(Utils.CopyArray(secret, 0, size));<br>
s2.AddRange(Utils.CopyArray(secret, secret.Length - size, size));<br>
<br>
var tbc = new List&lt;byte&gt;();<br>
tbc.AddRange(label);<br>
tbc.AddRange(seed);<br>
<br>
var md5Result = MD5Hash(s1.ToArray(), tbc.ToArray(), outputLength);<br>
<br>
var sha1Result = SHA1Hash(s2.ToArray(), tbc.ToArray(), outputLength);<br>
<br>
<br>
var result = new List&lt;byte&gt;();<br>
for (int i = 0; i &lt; outputLength; i++)<br>
result.Add((byte)(md5Result[i] ^ sha1Result[i]));<br>
<br>
return result.ToArray();<br>
}<br>
private static byte[] MD5Hash(byte[] secret, byte[] seed, int outputLength)<br>
{<br>
int iterations = (int)Math.Ceiling((double)outputLength / 16);<br>
<br>
HMACMD5 HMD5 = new HMACMD5(secret);<br>
<br>
var result = new List&lt;byte&gt;();<br>
byte[] A = null;<br>
for (int i = 0; i &lt;= iterations; i++)<br>
if (A == null)<br>
A = seed;<br>
else<br>
{<br>
A = HMD5.ComputeHash(A);<br>
<br>
var tBuff = new List&lt;byte&gt;();<br>
tBuff.AddRange(A);<br>
tBuff.AddRange(seed);<br>
<br>
var tb = HMD5.ComputeHash(tBuff.ToArray());<br>
<br>
result.AddRange(tb);<br>
}<br>
<br>
return result.ToArray();<br>
}<br>
<br>
private static byte[] SHA1Hash(byte[] secret, byte[] seed, int outputLength)<br>
{<br>
int iterations = (int)Math.Ceiling((double)outputLength / 20);<br>
<br>
HMACSHA1 HSHA1 = new HMACSHA1(secret);<br>
var result = new List&lt;byte&gt;();<br>
byte[] A = null;<br>
<br>
for (int i = 0; i &lt;= iterations; i++)<br>
if (A == null)<br>
A = seed;<br>
else<br>
{<br>
A = HSHA1.ComputeHash(A);<br>
<br>
var tBuff = new List&lt;byte&gt;();<br>
tBuff.AddRange(A);<br>
tBuff.AddRange(seed);<br>
<br>
var tb = HSHA1.ComputeHash(tBuff.ToArray());<br>
<br>
result.AddRange(tb);<br>
}<br>
<br>
return result.ToArray();<br>
}<br>
</p>
</div>
<div class="comment">
<h4>
Marcelo Gonçalves
</h4>
<p>Man, thanks for the explanation.<br>
<br>
i Was searching for a good explanation about these topics.<br>
<br>
Thank you !<br>
<br>
</p>
</div>
<div class="comment">
<h4>
<a href="https://uaetechnician.ae/ssl-installation-services" rel="nofollow" target="_blank">SSL installation services</a>
</h4>
<p>That'high, these secrets are fantastic. thanks for the incredible post.</p>
</div>
<div class="comment">
<h4>
Teo
</h4>
<p>Excellent, thank you </p>
</div>
<div class="comment">
<h4>
Saravanan M K
</h4>
<p>Correction#1:<br>
============<br>
<br>
In your example, the value u0 should be:<br>
<br>
u0 = label + clientHello.random + serverHello.random<br>
<br>
because that particular example explains the generation of 48 byte Master Secret. <br>
<br>
For the generation of key block, <br>
<br>
u0 = label + serverHello.random + clientHello.random<br>
<br>
Correction#2:<br>
============<br>
<br>
&gt; how to compute it from the pre-master secret after having removed the leading zeros bytes.<br>
<br>
Leading zero bytes should be removed only for DH and DHE. For ECDH and ECDHE, they should be retained.<br>
<br>
RFC8422 (and old RFC4992):<br>
==========<br>
5.10. ECDH, ECDSA, and RSA Computations<br>
<br>
All ECDH calculations for the NIST curves (including parameter and<br>
key generation as well as the shared secret calculation) are<br>
performed according to [IEEE.P1363] using the ECKAS-DH1 scheme with<br>
the identity map as the Key Derivation Function (KDF) so that the<br>
premaster secret is the x-coordinate of the ECDH shared secret<br>
elliptic curve point represented as an octet string. Note that this<br>
octet string (Z in IEEE 1363 terminology), as output by FE2OSP (Field<br>
Element to Octet String Conversion Primitive), has constant length<br>
for any given field; leading zeros found in this octet string MUST<br>
NOT be truncated.<br>
==========<br>
<br>
For RSA, since the first two bytes of the PMS is going to be client TLS version, it will always have non-zero value as the leading byte.<br>
</p>
</div>
<div class="comment">
<h4>
Chvash
</h4>
<p>Do you have a test vectors for TLS 1.2?<br>
I am trying with<br>
#client rand<br>
# 6E2CC4958409EE76232DFB9CE9A319CA5D004FE5D60C786C7E550CB06E88F601}<br>
#server rand<br>
# 8B66324D4D029852FDAA670D6F0F32662BFC476ED202CA0DB5D896CA4F13B0CA<br>
#PSK: 02B99BF7697763035E8883D4506061F2<br>
I got master key as:<br>
master key:<br>
31e40fca4d311de40ce57d784b027e93342d5314f6b00f373fbf146889cb2f43<br>
And A(1) as:<br>
5f074dfdef4474d60a9dc9e52eac793517c69902e553186e88f4148f4e0d5e84<br>
But I dont get where the follwing tested values are in there.<br>
clientWriteKey =<br>
00A02013931212D0637ED4F1651BC2A9<br>
<br>
clientWriteIV =<br>
1A5E165D3F8F404A7E381C687C8B8C73<br>
<br>
serverWriteKey =<br>
28F18DBA3553EE27FDE94FDCAA9F35BB<br>
<br>
serverWriteIV =<br>
DAE0DFFB22FEF2AB5B6A569A1D78AAC8<br>
<br>
Any advice? Maybe my hashMac calculation is being done wrong. (Hmac with SHA256)</p>
</div>
<div class="comment">
<h4>
<a href="https://www.cryptologie.net/article/340/tls-pre-master-secrets-and-master-secrets/No" rel="nofollow" target="_blank">Naveen </a>
</h4>
<p>Can anyone say how to find a(1) manually?</p>
</div>
<div class="comment">
<h4>
mh
</h4>
<p>Hi,<br>
<br>
Regarding the PRF, <br>
you have replaced A(i) from the RFC by u_i in your text; but the output should not be simply u_1 + u_2 + ...,<br>
but instead HMAC_hash(secret, u_1 + seed) + HMAC_hash(secret, u_2 + seed) + ...<br>
-&gt; Two HMAC calls per iteration.<br>
<br>
Cheers,<br>
mh</p>
</div>
<div class="comment">
<h4>
Daw
</h4>
<p>Why do we share the PMS with the server? Why can't we share the master key or the 6 derived keys directly to the Server.(Of course after encrypting them with pub-key of Server) ?<br>
<br>
Also why can't Server make the PMS and share it with Web Browser?</p>
</div>
<div class="comment">
<h4>
Burak
</h4>
<p>Thanks for the topic.<br>
Can u explain the PRF for the master secret and the key_block when extended master secret extension is used.<br>
master_secret = PRF(pre_master_secret, "extended master secret",<br>
session_hash)<br>
[0..47];<br>
is computed like this but there is no information about the PRF used for the key_block derivation.<br>
<br>
Original PRF is this as you mentioned in the topic but how it is modified for the EMS.<br>
key_block = PRF(SecurityParameters.master_secret,<br>
"key expansion",<br>
SecurityParameters.server_random +<br>
SecurityParameters.client_random);</p>
</div>
<h2>leave a comment...</h2>
<div class="commentaires">
<form method="post">
<fieldset>
<div class="form-group">
<label for="name">Your name</label>
<input type="text" class="form-control" id="name" placeholder="Enter name" name="name" required="">
</div>
<div class="form-group">
<label for="name">Do you have a homepage?</label>
<input type="text" class="form-control" id="web" placeholder="This information will be displayed" name="web">
</div>
<div class="form-group">
<label for="capital">Capital of Italy? (antispam)</label>
<input type="text" class="form-control" id="capital" placeholder="Enter antispam" name="capital" required="">
</div>
<div class="form-group">
<label for="text">Text</label>
<textarea class="form-control" rows="7" name="text" placeholder="Enter text" required=""></textarea>
</div>
<button type="submit" class="btn btn-default">Post</button>
</fieldset>
</form>
</div>
<form method="post"></form>
</div>
</main>
<section id="links">
<div class="book_promo">
<img src="./TLS, Pre-Master Secrets and Master Secrets_files/building4.png" width="300px">
<p>My book <strong>Real-World Cryptography</strong> is finished and shipping! <a href="https://www.manning.com/books/real-world-cryptography?a_aid=Realworldcrypto&amp;a_bid=ad500e09" style="color:#a54e1a">You can purchase it here</a>.</p>
</div>
<div class="popular">
<p>If you don't know <strong>where to start</strong>, you might want to check these popular articles:</p>
<ul class="fa-ul">
<li>- <a href="https://www.cryptologie.net/article/400/maybe-you-shouldnt-skip-sha-3/">Maybe you shouldn't skip SHA-3</a></li>
<li>- <a href="https://www.cryptologie.net/article/472/what-is-the-bls-signature-scheme/">What is the BLS signature scheme?</a></li>
<li>- <a href="https://www.cryptologie.net/article/193/schnorrs-signature-and-non-interactive-protocols/">Schnorr's Signature and non-interactive Protocols</a></li>
<li>- <a href="https://www.cryptologie.net/article/413/beast-an-explanation-of-the-cbc-attack-on-tls/">BEAST: An Explanation of the CBC Attack on TLS </a></li>
<li>- <a href="https://www.cryptologie.net/article/372/key-compromise-impersonation-attacks-kci/">Key Compromise Impersonation attacks (KCI)</a></li>
<li>- <a href="https://www.cryptologie.net/article/449/problems-that-udp-and-only-udp-has/">Problems that UDP and only UDP has</a></li>
<li>- <a href="https://www.cryptologie.net/article/471/database-encryption/">Database Encryption</a></li>
</ul>
</div>
<div class="links2">
<p>Here are the latest <strong><a href="https://www.cryptologie.net/links">links</a></strong> posted:</p>
<ul class="fa-ul">
<li>10 Jun <a href="https://www.cryptologie.net/links/link/2886#disqus_thread">Breaking Rainbow Takes A Weekend On A Laptop</a></li>
<li>09 Jun <a href="https://www.cryptologie.net/links/link/2885#disqus_thread">Several Improvements On Bkz Algorithm</a></li>
<li>08 Jun <a href="https://www.cryptologie.net/links/link/2884#disqus_thread">The Rainbow Attack</a></li>
<li>07 Jun <a href="https://www.cryptologie.net/links/link/2883#disqus_thread">Why Do We Say “It Is Probably Prime”? Surely It Is, Or It Isn’T!</a></li>
<li>06 Jun <a href="https://www.cryptologie.net/links/link/2882#disqus_thread">Explaining Yao's Garbled Circuits</a></li>
</ul>
<p style="margin:10px 0 0;">You can also <strong><a href="https://www.cryptologie.net/links#post">suggest a link</a></strong>.</p>
</div>
<div class="mailinglist style=" border:2px="" solid="" black;""="">

<link href="./TLS, Pre-Master Secrets and Master Secrets_files/classic-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
	      #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
	      /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
	      We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
	    </style>
<div id="mc_embed_signup">
<form action="https://davidwong.us18.list-manage.com/subscribe/post?u=8c101c590815d311e3783824c&amp;id=7347c1b15a" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="novalidate">
<div id="mc_embed_signup_scroll">
<h2>Subscribe to the mailing list</h2>
<div class="mc-field-group">
<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="your email" aria-required="true">
</div>
<div id="mce-responses" class="clear">
<div class="response" id="mce-error-response" style="display:none"></div>
<div class="response" id="mce-success-response" style="display:none"></div>
</div> 
<div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_8c101c590815d311e3783824c_7347c1b15a" tabindex="-1" value=""></div>
<div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
</div>
</form>
</div>
<script type="text/javascript" src="./TLS, Pre-Master Secrets and Master Secrets_files/mc-validate.js.下载"></script><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script>

</div>
</section>
</div>
</div>
<footer>
<div class="container">
<small>Thanks for reading! Need to tell me something? <a href="https://www.cryptologie.net/contact">Contact me</a></small>
</div>
</footer>
<script>
      var options = {theme: 'simple'};
      $(".sequence").sequenceDiagram(options);

      // to re-size the SVG, yolo
      /*
      $('svg').removeAttr('viewBox');

      $('svg').each(function () { 
      let svg = $(this)[0];
      let bbox = svg.getBBox();
      svg.setAttribute("viewBox", bbox.x + ' ' + bbox.y + ' ' + bbox.width + ' ' + bbox.height);
      });

      $('svg').css('width', '500px');
      $('svg').css('height', 'auto');
      */
    </script>
<script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-190811-18', 'auto');
      ga('send', 'pageview');

    </script>


</body></html>